# Система выдачи кредитов - REST API

## Описание

Данная система реализует базовую функциональность для выдачи кредитов с учетом различных правил и условий.

Система разработана с использованием архитектурных принципов:
- Domain-Driven Design (DDD)
- Clean Architecture
- SOLID
- Модульность и разделение ответственности

## Запуск проекта

### Требования

- PHP 8.3
- Composer

### Установка и запуск

1. Клонируйте репозиторий
2. Установите зависимости:
```bash
composer install
```
3. Запустите встроенный веб-сервер Symfony:
```bash
symfony server:start
```

## REST API

### Клиенты

#### Получение списка клиентов

```
GET /api/clients
```

#### Получение информации о клиенте

```
GET /api/clients/{pin}
```

#### Создание нового клиента

```
POST /api/clients
```

Пример запроса:
```json
{
    "name": "Petr Pavel",
    "age": 35,
    "region": "PR",
    "city": "Prague",
    "income": 1500,
    "score": 600,
    "pin": "123-45-6789",
    "email": "petr.pavel@example.com",
    "phone": "+420123456789"
}
```

### Кредиты

#### Получение списка кредитов

```
GET /api/credits
```

#### Создание нового кредита

```
POST /api/credits
```

Пример запроса:
```json
{
    "name": "Personal Loan",
    "amount": 1000,
    "rate": "10%",
    "start_date": "2024-01-01",
    "end_date": "2024-12-31"
}
```

#### Проверка возможности выдачи кредита

```
POST /api/credits/check-approval
```

Пример запроса:
```json
{
    "client_pin": "123-45-6789",
    "credit": {
        "name": "Personal Loan",
        "amount": 1000,
        "rate": "10%",
        "start_date": "2024-01-01",
        "end_date": "2024-12-31"
    }
}
```

#### Выдача кредита

```
POST /api/credits/issue
```

Пример запроса:
```json
{
    "client_pin": "123-45-6789",
    "credit": {
        "name": "Personal Loan",
        "amount": 1000,
        "rate": "10%",
        "start_date": "2024-01-01",
        "end_date": "2024-12-31"
    }
}
```

## Условия выдачи кредита

1. Кредитный рейтинг клиента (Score) > 500
2. Доход клиента ≥ $1000/мес
3. Возраст клиента от 18 до 60 лет
4. Кредит выдается только клиентам из регионов:
   - Прага (PR)
   - Брно (BR)
   - Острава (OS)
5. Клиентам из Праги рандомно отказывают
6. Клиентам из Остравы увеличивают процентную ставку на 5%

## Тестовые данные

При запуске системы в dev-окружении автоматически создаются тестовые клиенты:

1. Клиент из Праги:
   - PIN: 123-45-6789
   - Score: 600
   - Income: 1500

2. Клиент из Брно:
   - PIN: 234-56-7890
   - Score: 700
   - Income: 2000

3. Клиент из Остравы:
   - PIN: 345-67-8901
   - Score: 550
   - Income: 1200

4. Клиент с недостаточным доходом:
   - PIN: 456-78-9012
   - Score: 520
   - Income: 800

5. Клиент с низким кредитным рейтингом:
   - PIN: 567-89-0123
   - Score: 450
   - Income: 1800

## Тесты

Система включает автоматические тесты для API с использованием Codeception. Тесты проверяют основные сценарии работы системы:

- Создание и получение информации о клиентах
- Создание кредитов
- Проверка возможности выдачи кредита
- Выдача кредита
- Обработка негативных сценариев (отказ в кредите)

### Запуск тестов

Для запуска тестов API выполните:

```bash
vendor/bin/codecept run Api
```

### Структура тестов

- `tests/Api/ClientCest.php` - тесты для API работы с клиентами
- `tests/Api/CreditCest.php` - тесты для API работы с кредитами

Тесты используют in-memory репозитории, что позволяет избежать зависимости от внешних хранилищ данных. 